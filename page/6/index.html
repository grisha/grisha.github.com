<!DOCTYPE html>
<html lang="en" dir="auto" data-theme="auto">

<head>
	<meta name="generator" content="Hugo 0.146.0"><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>Gregory Trubetskoy</title>

<meta name="description" content="Notes to self.">
<meta name="author" content="Gregory Trubetskoy">
<link rel="canonical" href="http://localhost:1313/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.da3211e5ef867bf2b75fd5a6515cfed7195c011e8ab735694e203810a827097b.css" integrity="sha256-2jIR5e&#43;Ge/K3X9WmUVz&#43;1xlcAR6KtzVpTiA4EKgnCXs=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" type="application/rss+xml" href="http://localhost:1313/atom.xml" title="rss">
<link rel="alternate" hreflang="en" href="http://localhost:1313/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
                color-scheme: dark;
            }

            .list {
                background: var(--theme);
            }

            .toc {
                background: var(--entry);
            }
        }

        @media (prefers-color-scheme: light) {
            .list::-webkit-scrollbar-thumb {
                border-color: var(--code-bg);
            }
        }

    </style>
</noscript>
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.querySelector("html").dataset.theme = 'dark';
    } else if (localStorage.getItem("pref-theme") === "light") {
       document.querySelector("html").dataset.theme = 'light';
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.querySelector("html").dataset.theme = 'dark';
    } else {
        document.querySelector("html").dataset.theme = 'light';
    }

</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    jax: ["input/TeX", "output/HTML-CSS"],
    tex2jax: {
      inlineMath: [ ['$', '$'] ],
      displayMath: [ ['$$', '$$']],
      processEscapes: true,
    },
    messageStyle: "none",
    "HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] }
  });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML" type="text/javascript"></script>

</head>
<body class="list" id="top">
    <header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Gregory Trubetskoy (Alt + H)">Gregory Trubetskoy</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
        </ul>
    </nav>
</header>
<main class="main"> 

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">json2avro
    </h2>
  </header>
  <div class="entry-content">
    <p>As you embark on converting vast quantities of JSON to Avro, you soon discover that things are not as simple as they seem. Here is how it might happen.
A quick Google search eventually leads you to the avro-tools jar, and you find yourself attempting to convert some JSON, such as:
{&#34;first&#34;:&#34;John&#34;, &#34;middle&#34;:&#34;X&#34;, &#34;last&#34;:&#34;Doe&#34;} {&#34;first&#34;:&#34;Jane&#34;, &#34;last&#34;:&#34;Doe&#34;} Having read Avro documentation and being the clever being that you are, you start out with:
java -jar ~/src/avro/java/avro-tools-1.7.4.jar fromjson input.json --schema \ &#39;{&#34;type&#34;:&#34;record&#34;,&#34;name&#34;:&#34;whatever&#34;, &#34;fields&#34;:[{&#34;name&#34;:&#34;first&#34;, &#34;type&#34;:&#34;string&#34;}, {&#34;name&#34;:&#34;middle&#34;,&#34;type&#34;:&#34;string&#34;}, {&#34;name&#34;:&#34;last&#34;,&#34;type&#34;:&#34;string&#34;}]}&#39; &gt; output.avro Exception in thread &#34;main&#34; org.apache.avro.AvroTypeException: Expected field name not found: middle at org.apache.avro.io.JsonDecoder.doAction(JsonDecoder.java:477) at org.apache.avro.io.parsing.Parser.advance(Parser.java:88) ... A brief moment of disappointment is followed by the bliss of enlightment: Duh, the “middle” element needs a default! And so you try again, this time having tacked on a default to the definition of “middle”, so it looks like {&#34;name&#34;:&#34;middle&#34;,&#34;type&#34;:&#34;string&#34;,&#34;default&#34;:&#34;&#34;}:
...</p>
  </div>
  <footer class="entry-footer"><span title='2013-06-21 14:17:00 +0000 UTC'>June 21, 2013</span>&nbsp;·&nbsp;<span>Gregory Trubetskoy</span></footer>
  <a class="entry-link" aria-label="post link to json2avro" href="http://localhost:1313/blog/2013/06/21/json2avro/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Avro performance
    </h2>
  </header>
  <div class="entry-content">
    <p>Here are some un-scientific results on how Avro performs with various codecs, as well as vs JSON-lzo files in Hive and Impala. This testing was done using a 100 million row table that was generated using random two strings and an integer.
F J J J A A A o S S S v v v r O O O r r r m N N N o o o a t C n L D n S D o u Z e u n e d l O f l a f e l l l p l c a p a t y t e e ( ( g g z z i i p p ) ) D 6 2 1 3 2 1 a 8 8 7 0 6 5 t 6 5 5 1 0 6 a , , , , , , 7 5 8 7 4 5 S 6 5 7 1 5 5 i 9 8 8 0 0 0 z , , , , , , e 8 3 0 1 9 1 2 1 3 2 8 4 1 4 8 6 0 4 H n 7 n 4 3 6 i o 9 o 0 8 4 v t s t s s s e t t c e e o s s u t t n e e t d d ( 1 ) t i m e I N N N . . 2 m / / 4 9 . p A A A s s 8 a s l a c o u n t ( 1 ) t i m e So the winner appears to be Avro/Snappy or uncompressed Avro.
...</p>
  </div>
  <footer class="entry-footer"><span title='2013-06-11 00:17:00 +0000 UTC'>June 11, 2013</span>&nbsp;·&nbsp;<span>Gregory Trubetskoy</span></footer>
  <a class="entry-link" aria-label="post link to Avro performance" href="http://localhost:1313/blog/2013/06/11/avro-performance/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Apache Avro
    </h2>
  </header>
  <div class="entry-content">
    <p>Short version Avro is better than Json for storing table data Avro supports schema resolution so that the schema can evolve over time Hive supports Avro and schema resolution nicely Impala (1.0) can read Avro tables, but does not support schema resolution Mixing compression codecs in the same table works in both Hive and Impala The TL;DR version Introduction If you’re logging data into Hadoop to be analyzed, chances are you’re using JSON. JSON is great because it’s easy to generate in most any language, it’s human-readable, it’s universally supported and infinitely flexible.
...</p>
  </div>
  <footer class="entry-footer"><span title='2013-06-06 22:53:00 +0000 UTC'>June 6, 2013</span>&nbsp;·&nbsp;<span>Gregory Trubetskoy</span></footer>
  <a class="entry-link" aria-label="post link to Apache Avro" href="http://localhost:1313/blog/2013/06/06/apache-avro/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Simple Solution to Password Reuse
    </h2>
  </header>
  <div class="entry-content">
    <p> Here&#39;s a KISS solution to all your password reuse problems. It requires remembering only *one* strong password, lets you have a virtually limitless number of passwords, and, most importantly, does NOT store anything anywhere or transfer anything over the network (100% browser-side Javascript). Stupid Simple Password Generator Step 1: Think of a phrase you will always remember. Keep typing until the text on the right says &#34;strong&#34;. Punctuation, spaces, unusual words and mixed case while not required, are generally a good idea. The most important thing is that the script considers it strong. ...</p>
  </div>
  <footer class="entry-footer"><span title='2013-05-31 17:12:00 +0000 UTC'>May 31, 2013</span>&nbsp;·&nbsp;<span>Gregory Trubetskoy</span></footer>
  <a class="entry-link" aria-label="post link to Simple Solution to Password Reuse" href="http://localhost:1313/blog/2013/05/31/simple-solution-to-password-reuse/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Compiling Impala from Github
    </h2>
  </header>
  <div class="entry-content">
    <p>Apparently Impala has two versions of source code, one internal to Cloudera, the other available on Github. I’m presuming that code gets released to Github once undergone some level of internal scrutiny, but I’ve not seen any documentation on how one could tie publically available code to the official Impala (binary) release, currently 1.0.
Anyway, I tried compiling the github code last night, and here are the steps that worked for me.
...</p>
  </div>
  <footer class="entry-footer"><span title='2013-05-31 10:48:00 +0000 UTC'>May 31, 2013</span>&nbsp;·&nbsp;<span>Gregory Trubetskoy</span></footer>
  <a class="entry-link" aria-label="post link to Compiling Impala from Github" href="http://localhost:1313/blog/2013/05/31/compiling-impala-from-github/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">SQLite DB stored in a Redis hash
    </h2>
  </header>
  <div class="entry-content">
    <p>In a recent post I explained how a relational database could be backed by a key-value store by virtue of B-Trees. This sounded great in theory, but I wanted to see that it actually works. And so last night I wrote a commit to Thredis, which does exactly that.
If you’re not familiar with Thredis - it’s something I hacked together last Christmas. Thredis started out as threaded Redis, but eventually evolved into SQLite &#43; Redis. Thredis uses a separate file to save SQLite data. But with this patch it’s no longer necessary - a SQLite DB is entirely stored in a Redis Hash object.
...</p>
  </div>
  <footer class="entry-footer"><span title='2013-05-29 17:08:00 +0000 UTC'>May 29, 2013</span>&nbsp;·&nbsp;<span>Gregory Trubetskoy</span></footer>
  <a class="entry-link" aria-label="post link to SQLite DB stored in a Redis hash" href="http://localhost:1313/blog/2013/05/29/sqlite-db-stored-in-a-redis-hash/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Checking out Cloudera Impala
    </h2>
  </header>
  <div class="entry-content">
    <p>I’ve decided to check out Impala last week and here’s some notes on how that went.
First thoughts I was very impressed with how easy it was to install, even considering our unusual set up (see below). In my simple ad-hoc tests Impala performed orders of magnitude faster than Hive. So far it seems solid down to the little details, like the shell prompt with a fully functional libreadline and column headers nicely formatted.
...</p>
  </div>
  <footer class="entry-footer"><span title='2013-05-23 12:43:00 +0000 UTC'>May 23, 2013</span>&nbsp;·&nbsp;<span>Gregory Trubetskoy</span></footer>
  <a class="entry-link" aria-label="post link to Checking out Cloudera Impala" href="http://localhost:1313/blog/2013/05/23/checking-out-cloudera-impala/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Relational database on top of key-value store explained (or why B-trees are cool)
    </h2>
  </header>
  <div class="entry-content">
    <p>This post attempts to explain how a relational database can be implemented atop a key/value store, a subject that I’ve long found rather mysterious.
Every once in a while I would come across a mention that a relational database can be implemented using a key/value store (aka dictionary, hash table or hash map - for brevity I’ll be using map from here on).
Whenever I thought about it, it just didn’t make sense. A relational database needs to store rows in order, and that’s one feature that maps do not provide. Imagine we have a table keyed by employee id stored in a map and we need to traverse it by id in ascending order. A hypothetical keys() method would return us a list of ids ordered randomly. It’s impossible to iterate over a hash map in order. So how would a relational database work then?
...</p>
  </div>
  <footer class="entry-footer"><span title='2013-05-11 11:36:00 +0000 UTC'>May 11, 2013</span>&nbsp;·&nbsp;<span>Gregory Trubetskoy</span></footer>
  <a class="entry-link" aria-label="post link to Relational database on top of key-value store explained (or why B-trees are cool)" href="http://localhost:1313/blog/2013/05/11/relational-database-on-top-of-key-value-store-explained-or-why-b-trees-are-cool/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">MapJoin: a simple way to speed up your Hive queries
    </h2>
  </header>
  <div class="entry-content">
    <p>Mapjoin is a little-known feature of Hive. It allows a table to be loaded into memory so that a (very fast) join could be performed entirely within a mapper without having to use a Map/Reduce step. If your queries frequently rely on small table joins (e.g. cities or countries, etc.) you might see a very substantial speed-up from using mapjoins.
There are two ways to enable it. First is by using a hint, which looks like /*&#43; MAPJOIN(aliasname), MAPJOIN(anothertable) */. This C-style comment should be placed immediately following the SELECT. It directs Hive to load aliasname (which is a table or alias of the query) into memory.
...</p>
  </div>
  <footer class="entry-footer"><span title='2013-04-19 11:15:00 +0000 UTC'>April 19, 2013</span>&nbsp;·&nbsp;<span>Gregory Trubetskoy</span></footer>
  <a class="entry-link" aria-label="post link to MapJoin: a simple way to speed up your Hive queries" href="http://localhost:1313/blog/2013/04/19/mapjoin-a-simple-way-to-speed-up-your-hive-queries/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Linus on understanding pointers
    </h2>
  </header>
  <div class="entry-content">
    <p>A while back Linus Torvalds answered questions on Slashdot.
One of the answers was on the subject of understanding of pointers:
At the opposite end of the spectrum, I actually wish more people understood the really core low-level kind of coding. Not big, complex stuff like the lockless name lookup, but simply good use of pointers-to-pointers etc. For example, I’ve seen too many people who delete a singly-linked list entry by keeping track of the “prev” entry, and then to delete the entry, doing something like
...</p>
  </div>
  <footer class="entry-footer"><span title='2013-04-02 10:52:00 +0000 UTC'>April 2, 2013</span>&nbsp;·&nbsp;<span>Gregory Trubetskoy</span></footer>
  <a class="entry-link" aria-label="post link to Linus on understanding pointers" href="http://localhost:1313/blog/2013/04/02/linus-on-understanding-pointers/"></a>
</article>
<footer class="page-footer">
  <nav class="pagination">
    <a class="prev" href="http://localhost:1313/page/5/">
      «&nbsp;Prev&nbsp;
    </a>
    <a class="next" href="http://localhost:1313/page/7/">Next&nbsp;&nbsp;»
    </a>
  </nav>
</footer>
    </main>
    
<footer class="footer">
        <span>&copy; 2026 <a href="http://localhost:1313/">Gregory Trubetskoy</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu');
    if (menu) {
        
        const scrollPosition = localStorage.getItem("menu-scroll-position");
        if (scrollPosition) {
            menu.scrollLeft = parseInt(scrollPosition, 10);
        }
        
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        const html = document.querySelector("html");
        if (html.dataset.theme === "dark") {
            html.dataset.theme = 'light';
            localStorage.setItem("pref-theme", 'light');
        } else {
            html.dataset.theme = 'dark';
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
