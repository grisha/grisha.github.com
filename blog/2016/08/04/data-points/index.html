<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>How Data Points Build Up - Gregory Trubetskoy</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="" /><meta name="description" content="This silly SVG animation (animation not my strong suit) demonstrates what happens when multiple Tgres data points arrive within the same step (i.e. smallest time interval for this series, also known as PDP, primary data point).
You browser does not support SVG objects? Explanation Let&rsquo;s say we have a series with a step of 100 seconds. We receive the following data points, all within the 100 second interval of a single step:
" />






<meta name="generator" content="Hugo 0.146.0 with theme even" />


<link rel="canonical" href="https://grisha.org/blog/2016/08/04/data-points/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">

<link rel="stylesheet" href="/css/custom.css">


<meta property="og:url" content="https://grisha.org/blog/2016/08/04/data-points/">
  <meta property="og:site_name" content="Gregory Trubetskoy">
  <meta property="og:title" content="How Data Points Build Up">
  <meta property="og:description" content="This silly SVG animation (animation not my strong suit) demonstrates what happens when multiple Tgres data points arrive within the same step (i.e. smallest time interval for this series, also known as PDP, primary data point).
You browser does not support SVG objects? Explanation Let’s say we have a series with a step of 100 seconds. We receive the following data points, all within the 100 second interval of a single step:">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2016-08-04T10:35:00+00:00">
    <meta property="article:modified_time" content="2016-08-04T10:35:00+00:00">

  <meta itemprop="name" content="How Data Points Build Up">
  <meta itemprop="description" content="This silly SVG animation (animation not my strong suit) demonstrates what happens when multiple Tgres data points arrive within the same step (i.e. smallest time interval for this series, also known as PDP, primary data point).
You browser does not support SVG objects? Explanation Let’s say we have a series with a step of 100 seconds. We receive the following data points, all within the 100 second interval of a single step:">
  <meta itemprop="datePublished" content="2016-08-04T10:35:00+00:00">
  <meta itemprop="dateModified" content="2016-08-04T10:35:00+00:00">
  <meta itemprop="wordCount" content="575">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="How Data Points Build Up">
  <meta name="twitter:description" content="This silly SVG animation (animation not my strong suit) demonstrates what happens when multiple Tgres data points arrive within the same step (i.e. smallest time interval for this series, also known as PDP, primary data point).
You browser does not support SVG objects? Explanation Let’s say we have a series with a step of 100 seconds. We receive the following data points, all within the 100 second interval of a single step:">

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Gregory Trubetskoy</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/posts/">
        <li class="mobile-menu-item">Archives</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Gregory Trubetskoy</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/posts/">Archives</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">How Data Points Build Up</h1>

      <div class="post-meta">
        <span class="post-time"> 2016-08-04 </span>
        
        
      </div>
    </header>

    
    <div class="post-content">
      <p>This silly SVG animation (animation not my strong suit) demonstrates
what happens when multiple Tgres data points arrive within the same
step (i.e. smallest time interval for this series, also known as PDP,
primary data point).</p>
<object data="/images/data_point.svg" type="image/svg+xml">
  You browser does not support SVG objects?
</object>
<h3 id="explanation">Explanation</h3>
<p>Let&rsquo;s say we have a series with a step of 100 seconds. We receive the
following data points, all within the 100 second interval of a
single step:</p>
<table>
  <thead>
      <tr>
          <th>Time</th>
          <th>Value</th>
          <th>Recorded</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>25s</td>
          <td>2.0</td>
          <td>0.5</td>
      </tr>
      <tr>
          <td>75s</td>
          <td>3.0</td>
          <td>2.0</td>
      </tr>
      <tr>
          <td>100s</td>
          <td>1.0</td>
          <td>2.25</td>
      </tr>
      <tr>
          <td>&mdash;&mdash;-</td>
          <td>&mdash;&mdash;-</td>
          <td>&mdash;&mdash;&mdash;-</td>
      </tr>
      <tr>
          <td></td>
          <td>Final:</td>
          <td>2.25</td>
      </tr>
  </tbody>
</table>
<p/> Tgres will store 2.25 as the final value for this step. So how
does 1, 2 and 3 add up to _2.25_?
<p>One way to think about it is that the incomplete step is an empty
swimming pool as wide as 1 step, into which we dump blocks of
water. The first data point dumps a 2.0 × 0.25 block of water, which
fills the pool to 0.5. The second data point dumps a 3.0 × 0.50 block,
which raises the water another 1.5 to 2.0. The last data point dumps a
1.0 × 0.25 block which raises it to the final value of 2.25.  Compare
this with Graphite which would simply discard the first two data
points and we are left with 1.0 as the final value.</p>
<p>Why is it done this way? Because this is how rates add up. If this was
speed of a car in meters per second (more like a bycicle, I guess),
its weighted average speed for the duration of this step of 2.25
meters per second would mean that in the 100s it would have traveled
exactly 225 meters.</p>
<h3 id="nans-or-unknowns">NaNs or &ldquo;Unknowns&rdquo;</h3>
<p>What if instead of the first data point, the first 25s were &ldquo;unknown&rdquo;
(recorded as NaN)? This would happen, for example, if the series
heartbeat (maximum duration without any data) was exceeded. Even
though the data point has a value of 2.0, it gets recorded as NaN.</p>
<table>
  <thead>
      <tr>
          <th>Time</th>
          <th>Value</th>
          <th>Recorded</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>25s</td>
          <td>2.0</td>
          <td>NaN</td>
      </tr>
      <tr>
          <td>75s</td>
          <td>3.0</td>
          <td>2.0</td>
      </tr>
      <tr>
          <td>100s</td>
          <td>1.0</td>
          <td>2.33</td>
      </tr>
      <tr>
          <td>&mdash;&mdash;-</td>
          <td>&mdash;&mdash;-</td>
          <td>&mdash;&mdash;&mdash;-</td>
      </tr>
      <tr>
          <td></td>
          <td>Final:</td>
          <td>2.33</td>
      </tr>
  </tbody>
</table>
<p/>
But wait a second... 0.50 &times; 3 + 0.25 &times; 1 = 1.75 ? Where did
the value of 2.33 come from?
<p>The reason for this is that NaN ought not be influencing the
value. The above calculation would only be correct if we assumed that NaN is
synonymous with zero, but that would be a false assumption, as NaN
means &ldquo;we do not know&rdquo;.</p>
<p>Therefore, we must only consider the known part of the data point,
which is 75s. We can think of it that the data point (the &ldquo;swimming
pool&rdquo;) just got smaller.  Thus the correct calculation for the 3.0
point would be 3.0 × 50 ÷ 75 = 2.0 and for the 1.0 point
2.0 + 1.0 × 25 ÷ 75 = 2.33.</p>
<p>Here it is in SVG:</p>
<object data="/images/data_point_unk.svg" type="image/svg+xml">
  You browser does not support SVG objects?
</object>
<p>Also note how the value of the data point which was recorded as NaN
(2.0 in our example) is essentially irrelevant. This is because any
calculation with a NaN always results in a NaN. The only thing we know
about this data point is that it was not NaN and that it marked the
end of period recorded as NaN. The next data point after this (3.0 in
our example) is not affected by the NaN, however, this is because it
in effect starts its own data point afresh, not considering anything
in the past.</p>

    </div>

    
<footer class="post-footer">
      
      <nav class="post-nav">
        <a class="prev" href="/blog/2016/09/22/golang-receiver-vs-function/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Golang receiver vs function argument</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/blog/2016/07/29/state-of-tgres-2016/">
            <span class="next-text nav-default">Introducing Tgres - A Time Series DB on top of PostgreSQL</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        <div id="disqus_thread"></div>
    <script type="text/javascript">
    (function() {
      
      
      if (window.location.hostname === 'localhost') return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'grisha';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2013 - 
    2026<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
