
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>TimescaleDB - Grisha Trubetskoy</title>
  <meta name="author" content="Gregory Trubetskoy">

  
  <meta name="description" content="There is a new kid on the time series block:
TimescaleDB. (From here on
sometimes referred to as Timescale, for brevity). TimescaleDB is a
descendant &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://grisha.org/blog/2017/07/13/timescaledb">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Grisha Trubetskoy" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="https://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

<!-- MathJax -->
<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
  jax: ["input/TeX", "output/HTML-CSS"],
  tex2jax: {
    inlineMath: [ ['$', '$'] ],
    displayMath: [ ['$$', '$$']],
    processEscapes: true,
  },
  messageStyle: "none",
  "HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] }
  });
</script>
<!-- <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML" type="text/javascript"></script> -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML" type="text/javascript"></script>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-42971867-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Grisha Trubetskoy</a></h1>
  
    <h2>Notes to self.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:grisha.org" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">TimescaleDB</h1>
    
    
      <p class="meta">
        








  


<time datetime="2017-07-13T07:56:00-04:00" pubdate data-updated="true">Jul 13<span>th</span>, 2017</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>There is a new kid on the time series block:
<a href="https://github.com/timescale/timescaledb">TimescaleDB</a>. (From here on
sometimes referred to as <em>Timescale</em>, for brevity). TimescaleDB is a
descendant of the company formerly known as iobeam, a hosted data
analysis service for connected hardware. TimescaleDB is an
open-sourced and evolved version of the underlying data storage
technology.</p>

<p>What I find interesting about Timescale is that it is a Postgres-based
thing. In fact upon some digging I discovered that its very early
code (e.g. <a href="https://github.com/timescale/timescaledb/tree/c3d55d339e37de75fa2eab27d6537dca05cc6c48">here</a>)
consisted entirely in PL/pgSQL.</p>

<p>There isn’t a lot of documentation on how it works, though there is a
<a href="https://www.timescale.com/papers/timescaledb.pdf">paper</a>, but it
lacks on the implementation details. The paper
talks about the TimescaleDB <em>hypertable</em>, which to the best of my
understanding is another name for the <a href="https://en.wikipedia.org/wiki/OLAP_cube">OLAP cube</a>, aka hypercube.</p>

<p>I am not really an expert on OLAP cubes, but they are not a new
concept, e.g. “pivot tables” is a feature of MS Excel since version 5
released in 1993. My understanding is that under the hood it is a tree
structure where a parent is an element of some dimension of the cube
and children are then other dimensions related to the parent. This way
to find the intersection of “year 1993”, “month of June”, “sales”,
“phase of the moon” and “chickens” is a straight forward tree
traversal operation with the number of steps approximately equal to
the number of dimensions. If the entire structure is in RAM, this can
be extremely fast.</p>

<p>In any event, the initial PL/pgSQL TimescaleDB implementation didn’t
have any hypercubes, those were added later.</p>

<h2 id="how-does-it-work">How does it work?</h2>

<p>From staring at the code for a few hours, it looks like the general
idea is that once you convert your table to a hypertable it becomes a
partitioned table with insert triggers.  On INSERT, rows are added to
an in-memory hypercube while at the same time a second copy is written
to a
<a href="https://www.postgresql.org/docs/current/static/ddl-partitioning.html">partition</a>.
This partition is known as a <em>chunk</em>. The schema of the chunk is
identical to the original table, the chunk is a
<a href="https://www.postgresql.org/docs/current/static/ddl-inherit.html">child</a>
of the table.  You cannot see the chunks because they are tucked away
in a separate namespace. To the user it just acts like any other
table.</p>

<p>The data is divided
across partitions by the <em>chunk_time_interval</em> parameter, as well as
(optionally) another dimension (partitioning column) which you can specify as an argument to the
<a href="http://docs.timescale.com/api/api-timescaledb#create_hypertable">create_hypertable</a> function.
(As far as I can tell, only one such dimension is supported).</p>

<p>I am still not very clear on what is done to make inserts faster or even
if they are indeed faster than any other PG insert. I think that the
<a href="/blog/2017/01/21/storing-time-seris-in-postgresql-optimize-for-write/">trick</a>
we’re using in Tgres where a bunch of data points across multiple series
is sent as an array of a single row is a performance optimization that would
be hard to beat when it comes to writes.</p>

<p>As far as querying, if the chunk you need to answer the query is in
memory, then naturally it is extremely fast. If the chunk is not in
memory, then it will be loaded first, which too, is actually pretty
fast. I am not very clear on what happens when the query spans chunks
that are on disk and there isn’t enough memory to load them all, it
seems to me that in this case a Timescale table wouldn’t perform much
faster than any other Postgres one.</p>

<h2 id="conclusion">Conclusion</h2>

<p>I like it. I think the approach is a good one, especially because to
the extent possible, Timescale blends into Postgres and all the PG
tools are at your disposal. Timescale does not attempt to reinvent
storage, which is my biggest issue with most every “time series
database” out there. It leaves storage to the experts, if you trust
Postgres, you can trust TimescaleDB. It seems to me that it is not going to be
a solution to all problems, but in my limited testing it does provide
a very substantial (10x) speed up with not a lot of effort - all you
need to do is to call create_hypertable() after creating your table.</p>

<p>I still need to do some research on what is happening with the
inserts. I think that it would be interesting to experiment with Tgres
and see if it could run on top of Timescale, though that would be a
lot of work. There may also be some interesting stuff done whereby
incoming data is stored in the Tgres format, but then is somehow by
way of a trigger copied into a Timescale table and perhaps that could
make queries even faster.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Gregory Trubetskoy</span></span>

      








  


<time datetime="2017-07-13T07:56:00-04:00" pubdate data-updated="true">Jul 13<span>th</span>, 2017</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://grisha.org/blog/2017/07/13/timescaledb/" data-via="humblehack" data-counturl="http://grisha.org/blog/2017/07/13/timescaledb/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2017/04/27/simplistic-go-web-app/" title="Previous Post: Building a Go Web App in 2017">&laquo; Building a Go Web App in 2017</a>
      
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    

<section>
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 200;
google_ad_height = 200;
google_ad_format = "200x200_as";
google_ad_type = "image";
//-->
</script>
<div style="text-align: center;">
  <div style="text-align: left; width: 200px; display: block; margin-left: auto; margin-right: auto;">
    <script type="text/javascript"
            src="https://pagead2.googlesyndication.com/pagead/show_ads.js">
    </script>
  </div>
</div>
</section>

<section>
  <h1>About Me</h1>

  <p>
  <div style="width: 50%; margin: 0 auto;">
  <a href="https://twitter.com/humblehack" class="twitter-follow-button"
    data-show-count="">Follow @humblehack</a>
  </div>
  </p>

  <p>I am currently a (Data) Hacker at <a href="http://voxmedia.com">Vox Media</a>.</p>
  <p>Grisha is a common Russian short name for Gregory. It is pronounced more like Greesha.</p>
  <p>Years ago I wrote <a href="http://modpython.org">mod_python</a>, which became a hugely succesful OSS Project and is still in use by millions of sites.</p>
  <p>I am a former VP and member emeritus of the <a href="http://apache.org">Apache Software Foundation</a>.</p>
  <p>I started programming professionally back when I was a teenager.
  I've spent most of my early career working at large ISP's solving industrial-scale hosting challenges. Since around 2009 I've become more intersted in and now work exclusively on data infrastuctre, both big and small, but mostly big.</p>
  <p>I was born and grew up in Moscow, Russia, though I've lived in the Washington, DC (USA) area for more than half of my life now. Our kids were born and go to school here, it's gradually become home for us.</p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2017/07/13/timescaledb/">TimescaleDB</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/04/27/simplistic-go-web-app/">Building a Go Web App in 2017</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/04/27/simplistic-go-web-app-part-2/">Building a Go Web App - Part 2</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/04/27/go-web-app-part-3/">Building a Go Web App - Part 3</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/04/27/go-web-app-part-4/">Building a Go Web App - Part 4</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  <img src="https://www.ispol.com/grisha_org.gif" height="1" width="1">
  Copyright &copy; 2017 - Gregory Trubetskoy -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'grisha';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://grisha.org/blog/2017/07/13/timescaledb/';
        var disqus_url = 'http://grisha.org/blog/2017/07/13/timescaledb/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'https://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'https://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
