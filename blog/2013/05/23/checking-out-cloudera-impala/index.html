<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Checking out Cloudera Impala | Gregory Trubetskoy</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="I&rsquo;ve decided to check out
Impala
last week and here&rsquo;s some notes on how that went.
First thoughts
I was very impressed with how easy it was to install, even considering
our unusual set up (see below). In my simple ad-hoc tests Impala
performed orders of magnitude faster than Hive. So far it seems solid
down to the little details, like the shell prompt with a fully
functional libreadline and column headers nicely formatted.">
    <meta name="generator" content="Hugo 0.146.0">
    
    
    
      <meta name="robots" content="index, follow">
    
    <meta name="author" content="Gregory Trubetskoy">
    

    
<link rel="stylesheet" href="/ananke/css/main.min.d05fb5f317fcf33b3a52936399bdf6f47dc776516e1692e412ec7d76f4a5faa2.css" >




    


    
      

    

    

    
      <link rel="canonical" href="https://grisha.org/blog/2013/05/23/checking-out-cloudera-impala/">
    

    
    
    <meta property="og:url" content="https://grisha.org/blog/2013/05/23/checking-out-cloudera-impala/">
  <meta property="og:site_name" content="Gregory Trubetskoy">
  <meta property="og:title" content="Checking out Cloudera Impala">
  <meta property="og:description" content="I’ve decided to check out Impala last week and here’s some notes on how that went.
First thoughts I was very impressed with how easy it was to install, even considering our unusual set up (see below). In my simple ad-hoc tests Impala performed orders of magnitude faster than Hive. So far it seems solid down to the little details, like the shell prompt with a fully functional libreadline and column headers nicely formatted.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2013-05-23T12:43:00+00:00">
    <meta property="article:modified_time" content="2013-05-23T12:43:00+00:00">

  <meta itemprop="name" content="Checking out Cloudera Impala">
  <meta itemprop="description" content="I’ve decided to check out Impala last week and here’s some notes on how that went.
First thoughts I was very impressed with how easy it was to install, even considering our unusual set up (see below). In my simple ad-hoc tests Impala performed orders of magnitude faster than Hive. So far it seems solid down to the little details, like the shell prompt with a fully functional libreadline and column headers nicely formatted.">
  <meta itemprop="datePublished" content="2013-05-23T12:43:00+00:00">
  <meta itemprop="dateModified" content="2013-05-23T12:43:00+00:00">
  <meta itemprop="wordCount" content="680">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Checking out Cloudera Impala">
  <meta name="twitter:description" content="I’ve decided to check out Impala last week and here’s some notes on how that went.
First thoughts I was very impressed with how easy it was to install, even considering our unusual set up (see below). In my simple ad-hoc tests Impala performed orders of magnitude faster than Hive. So far it seems solid down to the little details, like the shell prompt with a fully functional libreadline and column headers nicely formatted.">

      
      
    
	
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    jax: ["input/TeX", "output/HTML-CSS"],
    tex2jax: {
      inlineMath: [ ['$', '$'] ],
      displayMath: [ ['$$', '$$']],
      processEscapes: true,
    },
    messageStyle: "none",
    "HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] }
  });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML" type="text/javascript"></script>

  </head><body class="ma0 avenir bg-near-white production">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l center items-center justify-between">
    <a href="/" class="f3 fw2 hover-white white-90 dib no-underline">
      
        Gregory Trubetskoy
      
    </a>
    <div class="flex-l items-center">
      

      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white white-90 no-underline" href="/archives/" title="Archives page">
              Archives
            </a>
          </li>
          
        </ul>
      
      <div class="ananke-socials"></div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l mw7 center ph3 flex-wrap justify-between">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Posts
      </aside><div id="sharing" class="mt3 ananke-socials"></div>
<h1 class="f1 athelas mt3 mb1">Checking out Cloudera Impala</h1>
      
      <p class="tracked"><strong>Gregory Trubetskoy</strong>
      </p>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2013-05-23T12:43:00Z">May 23, 2013</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-100-l"><p>I&rsquo;ve decided to check out
<a href="http://blog.cloudera.com/blog/2012/10/cloudera-impala-real-time-queries-in-apache-hadoop-for-real/">Impala</a>
last week and here&rsquo;s some notes on how that went.</p>
<h2 id="first-thoughts">First thoughts</h2>
<p>I was very impressed with how easy it was to install, even considering
our unusual set up (see below). In my simple ad-hoc tests Impala
performed orders of magnitude faster than Hive. So far it seems solid
down to the little details, like the shell prompt with a fully
functional libreadline and column headers nicely formatted.</p>
<h2 id="installing">Installing</h2>
<p>The first problem I encountered was that we use Cloudera
<a href="http://www.cloudera.com/content/cloudera-content/cloudera-docs/CDHTarballs/3.25.2013/CDH4-Downloadable-Tarballs/CDH4-Downloadable-Tarballs.html">tarballs</a>
in our set up, but Impala is only available as a package (RPM in our
case). I tried compiling it from
<a href="https://github.com/cloudera/impala">source</a>, but it&rsquo;s not a trivial
compile - it requires <a href="http://llvm.org/">LLVM</a> (which is way cool,
BTW) and has a bunch of dependencies, it didn&rsquo;t work out-of-the-box
for me so I&rsquo;ve decided to take an alternative route (I will definitely get it compiled some weekend soon).</p>
<p>Retreiving contents of an RPM is trivial (because it&rsquo;s really a cpio
archive), and then I&rsquo;d just have to &ldquo;make it work&rdquo;.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ curl -O http://archive.cloudera.com/impala/redhat/6/x86_64/impala/1.0/RPMS/x86_64/impala-server-1.0-1.p0.819.el6.x86_64.rpm
</span></span><span style="display:flex;"><span>$ mkdir impala
</span></span><span style="display:flex;"><span>$ cd impala
</span></span><span style="display:flex;"><span>$ rpm2cpio ../impala-server-1.0-1.p0.819.el6.x86_64.rpm | cpio -idmv
</span></span></code></pre></div><p>I noticed that <code>usr/bin/impalad</code> is a shell script, and it appears to
rely on a few environment vars for configuration, so I created a shell
script that sets them which looks approximately like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>export JAVA_HOME<span style="color:#f92672">=</span>/usr/java/default
</span></span><span style="display:flex;"><span>export IMPALA_LOG_DIR<span style="color:#f92672">=</span> <span style="color:#75715e"># your log dir</span>
</span></span><span style="display:flex;"><span>export IMPALA_STATE_STORE_PORT<span style="color:#f92672">=</span><span style="color:#ae81ff">24000</span>
</span></span><span style="display:flex;"><span>export IMPALA_STATE_STORE_HOST<span style="color:#f92672">=</span> <span style="color:#75715e"># probably namenode host or whatever</span>
</span></span><span style="display:flex;"><span>export IMPALA_BACKEND_PORT<span style="color:#f92672">=</span><span style="color:#ae81ff">22000</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>export IMPALA_HOME<span style="color:#f92672">=</span> <span style="color:#75715e"># full path to usr/lib/impala from the RPM, e.g. /home/grisha/impala/usr/lib/impala</span>
</span></span><span style="display:flex;"><span>export IMPALA_CONF_DIR<span style="color:#f92672">=</span> <span style="color:#75715e"># config dir, e.g. /home/grisha/impala/etc/impala&#34;</span>
</span></span><span style="display:flex;"><span>export IMPALA_BIN<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>IMPALA_HOME<span style="color:#e6db74">}</span>/sbin-retail
</span></span><span style="display:flex;"><span>export LIBHDFS_OPTS<span style="color:#f92672">=</span>-Djava.library.path<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>IMPALA_HOME<span style="color:#e6db74">}</span>/lib
</span></span><span style="display:flex;"><span>export MYSQL_CONNECTOR_JAR<span style="color:#f92672">=</span> <span style="color:#75715e"># full path a mysql-connect jar</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>export HIVE_HOME<span style="color:#f92672">=</span> <span style="color:#75715e"># your hive home - note: every impala nodes needs it, just config, not the whole Hive install</span>
</span></span><span style="display:flex;"><span>export HIVE_CONF_DIR<span style="color:#f92672">=</span> <span style="color:#75715e"># this seems redundant, my guess HIVE_HOME is enough, but whatever</span>
</span></span><span style="display:flex;"><span>export HADOOP_CONF_DIR<span style="color:#f92672">=</span> <span style="color:#75715e"># path the hadoop config, the dir that has hdfs-site.xml, etc.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>export IMPALA_STATE_STORE_ARGS<span style="color:#f92672">=</span><span style="color:#e6db74">&#34; -log_dir=</span><span style="color:#e6db74">${</span>IMPALA_LOG_DIR<span style="color:#e6db74">}</span><span style="color:#e6db74"> -state_store_port=</span><span style="color:#e6db74">${</span>IMPALA_STATE_STORE_PORT<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>export IMPALA_SERVER_ARGS<span style="color:#f92672">=</span><span style="color:#e6db74">&#34; \                                                                                                                                                                                  -log_dir=</span><span style="color:#e6db74">${</span>IMPALA_LOG_DIR<span style="color:#e6db74">}</span><span style="color:#e6db74"> \                                                                                                                                                                              -state_store_port=</span><span style="color:#e6db74">${</span>IMPALA_STATE_STORE_PORT<span style="color:#e6db74">}</span><span style="color:#e6db74"> \                                                                                                                                                            -use_statestore \                                                                                                                                                                                         -state_store_host=</span><span style="color:#e6db74">${</span>IMPALA_STATE_STORE_HOST<span style="color:#e6db74">}</span><span style="color:#e6db74"> \                                                                                                                                                            -be_port=</span><span style="color:#e6db74">${</span>IMPALA_BACKEND_PORT<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span></code></pre></div><p>With the above environment vars set, starting Impala should amount to
the following (you probably want to run those in separate windows, also note that
the state store needs to be started first):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ ./usr/bin/statestored <span style="color:#e6db74">${</span>IMPALA_STATE_STORE_ARGS<span style="color:#e6db74">}</span> <span style="color:#75715e"># do this on IMPALA_STATE_STORE_HOST only</span>
</span></span><span style="display:flex;"><span>$ ./usr/bin/impalad <span style="color:#e6db74">${</span>IMPALA_SERVER_ARGS<span style="color:#e6db74">}</span> <span style="color:#75715e"># do this on every node</span>
</span></span></code></pre></div><p>The only problem that I encountered was that Impala needed
short-circuit access enabled, so I had to add the following to the hdfs-site.xml:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>     <span style="color:#f92672">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">&lt;name&gt;</span>dfs.client.read.shortcircuit<span style="color:#f92672">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">&lt;value&gt;</span>true<span style="color:#f92672">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">&lt;name&gt;</span>dfs.domain.socket.path<span style="color:#f92672">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">&lt;!-- adjust this to your set up: --&gt;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">&lt;value&gt;</span>/var/run/dfs_domain_socket_PORT.sock<span style="color:#f92672">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">&lt;name&gt;</span>dfs.client.file-block-storage-locations.timeout<span style="color:#f92672">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">&lt;value&gt;</span>3000<span style="color:#f92672">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">&lt;!-- adjust this too: --&gt;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">&lt;name&gt;</span>dfs.block.local-path-access.user<span style="color:#f92672">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">&lt;value&gt;</span><span style="color:#75715e">&lt;!-- user name --&gt;</span><span style="color:#f92672">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">&lt;/property&gt;</span>
</span></span></code></pre></div><p>Once the above works, we need <code>impala-shell</code> to test it. Again, I pulled it out of the RPM:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ curl -O http://archive.cloudera.com/impala/redhat/6/x86_64/impala/1.0/RPMS/x86_64/impala-shell-1.0-1.p0.819.el6.x86_64.rpm
</span></span><span style="display:flex;"><span>$ mkdir shell ; cd shell
</span></span><span style="display:flex;"><span>$ rpm2cpio ../impala-shell-1.0-1.p0.819.el6.x86_64.rpm | cpio -idmv
</span></span></code></pre></div><p>I was then able to start the shell and connect. You can connect to any Impala node (read the docs):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span> .<span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>bin<span style="color:#f92672">/</span>impala<span style="color:#f92672">-</span>shell
</span></span><span style="display:flex;"><span>[localhost:<span style="color:#ae81ff">21000</span>] <span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">connect</span> some_node;
</span></span><span style="display:flex;"><span>Connected <span style="color:#66d9ef">to</span> some_node:<span style="color:#ae81ff">21000</span>
</span></span><span style="display:flex;"><span>Server <span style="color:#66d9ef">version</span>: impalad <span style="color:#66d9ef">version</span> <span style="color:#ae81ff">1</span>.<span style="color:#ae81ff">0</span> RELEASE (build d1bf0d1dac339af3692ffa17a5e3fdae0aed751f)
</span></span><span style="display:flex;"><span>[some_node:<span style="color:#ae81ff">21000</span>] <span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> <span style="color:#66d9ef">count</span>(<span style="color:#f92672">*</span>) <span style="color:#66d9ef">from</span> your_favorite_table;
</span></span><span style="display:flex;"><span>Query: <span style="color:#66d9ef">select</span> <span style="color:#66d9ef">count</span>(<span style="color:#f92672">*</span>) <span style="color:#66d9ef">from</span> your_favorite_table
</span></span><span style="display:flex;"><span>Query finished, fetching results ...
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span><span style="color:#75715e">-----------+
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">count</span>(<span style="color:#f92672">*</span>)  <span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span><span style="color:#75715e">-----------+
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#ae81ff">302052158</span> <span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span><span style="color:#75715e">-----------+
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>Returned <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span>(s) <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">2</span>.<span style="color:#ae81ff">35</span>s
</span></span></code></pre></div><p>Ta-da! The above query takes a good few minutes in Hive, BTW.</p>
<h2 id="other-notes">Other Notes</h2>
<ul>
<li>Impala does not support custom SerDe&rsquo;s so it won&rsquo;t work if you&rsquo;re relying on JSON. It does support Avro.</li>
<li>There is no support for UDF&rsquo;s, so our <a href="https://github.com/livingsocial/HiveSwarm">HiveSwarm</a> is of no use.</li>
<li>INSERT OVERWRITE works, which is good.</li>
<li>LZO support works too.</li>
<li><em>Security Warning</em>: Everything Impala does will appear in HDFS as
the user under which Impala is running. Be careful with this if
you&rsquo;re relying on HDFS permissions to prevent an accidental &ldquo;INSERT
OVERWRITE&rdquo;, as you might inadvertently give your users superuser
privs on HDFS via Hue, for example. (Oh did I mention Hue completely
supports Impala too?). From what I can tell there is no way to set a
username, this is a bit of a show-stopper for us, actually.</li>
</ul>
<ul class="pa0">
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div></article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white white-70 dn dib-ns pv2 ph3 no-underline" href="https://grisha.org/" >
    &copy;  Gregory Trubetskoy 2026 
  </a>
    <div><div class="ananke-socials"></div>
</div>
  </div>
</footer>

  </body>
</html>
