<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Checking out Cloudera Impala - Gregory Trubetskoy</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="" /><meta name="description" content="I&rsquo;ve decided to check out Impala last week and here&rsquo;s some notes on how that went.
First thoughts I was very impressed with how easy it was to install, even considering our unusual set up (see below). In my simple ad-hoc tests Impala performed orders of magnitude faster than Hive. So far it seems solid down to the little details, like the shell prompt with a fully functional libreadline and column headers nicely formatted.
" />






<meta name="generator" content="Hugo 0.146.0 with theme even" />


<link rel="canonical" href="https://grisha.org/blog/2013/05/23/checking-out-cloudera-impala/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">

<link rel="stylesheet" href="/css/custom.css">


<meta property="og:url" content="https://grisha.org/blog/2013/05/23/checking-out-cloudera-impala/">
  <meta property="og:site_name" content="Gregory Trubetskoy">
  <meta property="og:title" content="Checking out Cloudera Impala">
  <meta property="og:description" content="I’ve decided to check out Impala last week and here’s some notes on how that went.
First thoughts I was very impressed with how easy it was to install, even considering our unusual set up (see below). In my simple ad-hoc tests Impala performed orders of magnitude faster than Hive. So far it seems solid down to the little details, like the shell prompt with a fully functional libreadline and column headers nicely formatted.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2013-05-23T12:43:00+00:00">
    <meta property="article:modified_time" content="2013-05-23T12:43:00+00:00">

  <meta itemprop="name" content="Checking out Cloudera Impala">
  <meta itemprop="description" content="I’ve decided to check out Impala last week and here’s some notes on how that went.
First thoughts I was very impressed with how easy it was to install, even considering our unusual set up (see below). In my simple ad-hoc tests Impala performed orders of magnitude faster than Hive. So far it seems solid down to the little details, like the shell prompt with a fully functional libreadline and column headers nicely formatted.">
  <meta itemprop="datePublished" content="2013-05-23T12:43:00+00:00">
  <meta itemprop="dateModified" content="2013-05-23T12:43:00+00:00">
  <meta itemprop="wordCount" content="680">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Checking out Cloudera Impala">
  <meta name="twitter:description" content="I’ve decided to check out Impala last week and here’s some notes on how that went.
First thoughts I was very impressed with how easy it was to install, even considering our unusual set up (see below). In my simple ad-hoc tests Impala performed orders of magnitude faster than Hive. So far it seems solid down to the little details, like the shell prompt with a fully functional libreadline and column headers nicely formatted.">

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Gregory Trubetskoy</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/posts/">
        <li class="mobile-menu-item">Archives</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Gregory Trubetskoy</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/posts/">Archives</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Checking out Cloudera Impala</h1>

      <div class="post-meta">
        <span class="post-time"> 2013-05-23 </span>
        
        
      </div>
    </header>

    
    <div class="post-content">
      <p>I&rsquo;ve decided to check out
<a href="http://blog.cloudera.com/blog/2012/10/cloudera-impala-real-time-queries-in-apache-hadoop-for-real/">Impala</a>
last week and here&rsquo;s some notes on how that went.</p>
<h2 id="first-thoughts">First thoughts</h2>
<p>I was very impressed with how easy it was to install, even considering
our unusual set up (see below). In my simple ad-hoc tests Impala
performed orders of magnitude faster than Hive. So far it seems solid
down to the little details, like the shell prompt with a fully
functional libreadline and column headers nicely formatted.</p>
<h2 id="installing">Installing</h2>
<p>The first problem I encountered was that we use Cloudera
<a href="http://www.cloudera.com/content/cloudera-content/cloudera-docs/CDHTarballs/3.25.2013/CDH4-Downloadable-Tarballs/CDH4-Downloadable-Tarballs.html">tarballs</a>
in our set up, but Impala is only available as a package (RPM in our
case). I tried compiling it from
<a href="https://github.com/cloudera/impala">source</a>, but it&rsquo;s not a trivial
compile - it requires <a href="http://llvm.org/">LLVM</a> (which is way cool,
BTW) and has a bunch of dependencies, it didn&rsquo;t work out-of-the-box
for me so I&rsquo;ve decided to take an alternative route (I will definitely get it compiled some weekend soon).</p>
<p>Retreiving contents of an RPM is trivial (because it&rsquo;s really a cpio
archive), and then I&rsquo;d just have to &ldquo;make it work&rdquo;.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ curl -O http://archive.cloudera.com/impala/redhat/6/x86_64/impala/1.0/RPMS/x86_64/impala-server-1.0-1.p0.819.el6.x86_64.rpm
</span></span><span style="display:flex;"><span>$ mkdir impala
</span></span><span style="display:flex;"><span>$ cd impala
</span></span><span style="display:flex;"><span>$ rpm2cpio ../impala-server-1.0-1.p0.819.el6.x86_64.rpm | cpio -idmv
</span></span></code></pre></div><p>I noticed that <code>usr/bin/impalad</code> is a shell script, and it appears to
rely on a few environment vars for configuration, so I created a shell
script that sets them which looks approximately like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>export JAVA_HOME<span style="color:#f92672">=</span>/usr/java/default
</span></span><span style="display:flex;"><span>export IMPALA_LOG_DIR<span style="color:#f92672">=</span> <span style="color:#75715e"># your log dir</span>
</span></span><span style="display:flex;"><span>export IMPALA_STATE_STORE_PORT<span style="color:#f92672">=</span><span style="color:#ae81ff">24000</span>
</span></span><span style="display:flex;"><span>export IMPALA_STATE_STORE_HOST<span style="color:#f92672">=</span> <span style="color:#75715e"># probably namenode host or whatever</span>
</span></span><span style="display:flex;"><span>export IMPALA_BACKEND_PORT<span style="color:#f92672">=</span><span style="color:#ae81ff">22000</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>export IMPALA_HOME<span style="color:#f92672">=</span> <span style="color:#75715e"># full path to usr/lib/impala from the RPM, e.g. /home/grisha/impala/usr/lib/impala</span>
</span></span><span style="display:flex;"><span>export IMPALA_CONF_DIR<span style="color:#f92672">=</span> <span style="color:#75715e"># config dir, e.g. /home/grisha/impala/etc/impala&#34;</span>
</span></span><span style="display:flex;"><span>export IMPALA_BIN<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>IMPALA_HOME<span style="color:#e6db74">}</span>/sbin-retail
</span></span><span style="display:flex;"><span>export LIBHDFS_OPTS<span style="color:#f92672">=</span>-Djava.library.path<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>IMPALA_HOME<span style="color:#e6db74">}</span>/lib
</span></span><span style="display:flex;"><span>export MYSQL_CONNECTOR_JAR<span style="color:#f92672">=</span> <span style="color:#75715e"># full path a mysql-connect jar</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>export HIVE_HOME<span style="color:#f92672">=</span> <span style="color:#75715e"># your hive home - note: every impala nodes needs it, just config, not the whole Hive install</span>
</span></span><span style="display:flex;"><span>export HIVE_CONF_DIR<span style="color:#f92672">=</span> <span style="color:#75715e"># this seems redundant, my guess HIVE_HOME is enough, but whatever</span>
</span></span><span style="display:flex;"><span>export HADOOP_CONF_DIR<span style="color:#f92672">=</span> <span style="color:#75715e"># path the hadoop config, the dir that has hdfs-site.xml, etc.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>export IMPALA_STATE_STORE_ARGS<span style="color:#f92672">=</span><span style="color:#e6db74">&#34; -log_dir=</span><span style="color:#e6db74">${</span>IMPALA_LOG_DIR<span style="color:#e6db74">}</span><span style="color:#e6db74"> -state_store_port=</span><span style="color:#e6db74">${</span>IMPALA_STATE_STORE_PORT<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>export IMPALA_SERVER_ARGS<span style="color:#f92672">=</span><span style="color:#e6db74">&#34; \                                                                                                                                                                                  -log_dir=</span><span style="color:#e6db74">${</span>IMPALA_LOG_DIR<span style="color:#e6db74">}</span><span style="color:#e6db74"> \                                                                                                                                                                              -state_store_port=</span><span style="color:#e6db74">${</span>IMPALA_STATE_STORE_PORT<span style="color:#e6db74">}</span><span style="color:#e6db74"> \                                                                                                                                                            -use_statestore \                                                                                                                                                                                         -state_store_host=</span><span style="color:#e6db74">${</span>IMPALA_STATE_STORE_HOST<span style="color:#e6db74">}</span><span style="color:#e6db74"> \                                                                                                                                                            -be_port=</span><span style="color:#e6db74">${</span>IMPALA_BACKEND_PORT<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span></code></pre></div><p>With the above environment vars set, starting Impala should amount to
the following (you probably want to run those in separate windows, also note that
the state store needs to be started first):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ ./usr/bin/statestored <span style="color:#e6db74">${</span>IMPALA_STATE_STORE_ARGS<span style="color:#e6db74">}</span> <span style="color:#75715e"># do this on IMPALA_STATE_STORE_HOST only</span>
</span></span><span style="display:flex;"><span>$ ./usr/bin/impalad <span style="color:#e6db74">${</span>IMPALA_SERVER_ARGS<span style="color:#e6db74">}</span> <span style="color:#75715e"># do this on every node</span>
</span></span></code></pre></div><p>The only problem that I encountered was that Impala needed
short-circuit access enabled, so I had to add the following to the hdfs-site.xml:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>     <span style="color:#f92672">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">&lt;name&gt;</span>dfs.client.read.shortcircuit<span style="color:#f92672">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">&lt;value&gt;</span>true<span style="color:#f92672">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">&lt;name&gt;</span>dfs.domain.socket.path<span style="color:#f92672">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">&lt;!-- adjust this to your set up: --&gt;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">&lt;value&gt;</span>/var/run/dfs_domain_socket_PORT.sock<span style="color:#f92672">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">&lt;name&gt;</span>dfs.client.file-block-storage-locations.timeout<span style="color:#f92672">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">&lt;value&gt;</span>3000<span style="color:#f92672">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">&lt;property&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">&lt;!-- adjust this too: --&gt;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">&lt;name&gt;</span>dfs.block.local-path-access.user<span style="color:#f92672">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">&lt;value&gt;</span><span style="color:#75715e">&lt;!-- user name --&gt;</span><span style="color:#f92672">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">&lt;/property&gt;</span>
</span></span></code></pre></div><p>Once the above works, we need <code>impala-shell</code> to test it. Again, I pulled it out of the RPM:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ curl -O http://archive.cloudera.com/impala/redhat/6/x86_64/impala/1.0/RPMS/x86_64/impala-shell-1.0-1.p0.819.el6.x86_64.rpm
</span></span><span style="display:flex;"><span>$ mkdir shell ; cd shell
</span></span><span style="display:flex;"><span>$ rpm2cpio ../impala-shell-1.0-1.p0.819.el6.x86_64.rpm | cpio -idmv
</span></span></code></pre></div><p>I was then able to start the shell and connect. You can connect to any Impala node (read the docs):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span> .<span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>bin<span style="color:#f92672">/</span>impala<span style="color:#f92672">-</span>shell
</span></span><span style="display:flex;"><span>[localhost:<span style="color:#ae81ff">21000</span>] <span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">connect</span> some_node;
</span></span><span style="display:flex;"><span>Connected <span style="color:#66d9ef">to</span> some_node:<span style="color:#ae81ff">21000</span>
</span></span><span style="display:flex;"><span>Server <span style="color:#66d9ef">version</span>: impalad <span style="color:#66d9ef">version</span> <span style="color:#ae81ff">1</span>.<span style="color:#ae81ff">0</span> RELEASE (build d1bf0d1dac339af3692ffa17a5e3fdae0aed751f)
</span></span><span style="display:flex;"><span>[some_node:<span style="color:#ae81ff">21000</span>] <span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> <span style="color:#66d9ef">count</span>(<span style="color:#f92672">*</span>) <span style="color:#66d9ef">from</span> your_favorite_table;
</span></span><span style="display:flex;"><span>Query: <span style="color:#66d9ef">select</span> <span style="color:#66d9ef">count</span>(<span style="color:#f92672">*</span>) <span style="color:#66d9ef">from</span> your_favorite_table
</span></span><span style="display:flex;"><span>Query finished, fetching results ...
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span><span style="color:#75715e">-----------+
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">count</span>(<span style="color:#f92672">*</span>)  <span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span><span style="color:#75715e">-----------+
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#ae81ff">302052158</span> <span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span><span style="color:#75715e">-----------+
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>Returned <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span>(s) <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">2</span>.<span style="color:#ae81ff">35</span>s
</span></span></code></pre></div><p>Ta-da! The above query takes a good few minutes in Hive, BTW.</p>
<h2 id="other-notes">Other Notes</h2>
<ul>
<li>Impala does not support custom SerDe&rsquo;s so it won&rsquo;t work if you&rsquo;re relying on JSON. It does support Avro.</li>
<li>There is no support for UDF&rsquo;s, so our <a href="https://github.com/livingsocial/HiveSwarm">HiveSwarm</a> is of no use.</li>
<li>INSERT OVERWRITE works, which is good.</li>
<li>LZO support works too.</li>
<li><em>Security Warning</em>: Everything Impala does will appear in HDFS as
the user under which Impala is running. Be careful with this if
you&rsquo;re relying on HDFS permissions to prevent an accidental &ldquo;INSERT
OVERWRITE&rdquo;, as you might inadvertently give your users superuser
privs on HDFS via Hue, for example. (Oh did I mention Hue completely
supports Impala too?). From what I can tell there is no way to set a
username, this is a bit of a show-stopper for us, actually.</li>
</ul>

    </div>

    
<footer class="post-footer">
      
      <nav class="post-nav">
        <a class="prev" href="/blog/2013/05/29/sqlite-db-stored-in-a-redis-hash/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">SQLite DB stored in a Redis hash</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/blog/2013/05/11/relational-database-on-top-of-key-value-store-explained/">
            <span class="next-text nav-default">Relational database on top of key-value store explained (or why B-trees are cool)</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        <div id="disqus_thread"></div>
    <script type="text/javascript">
    (function() {
      
      
      if (window.location.hostname === 'localhost') return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'grisha';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2013 - 
    2026<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
