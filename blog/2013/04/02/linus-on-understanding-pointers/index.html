<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Linus on understanding pointers - Gregory Trubetskoy</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="" /><meta name="description" content="A while back Linus Torvalds answered questions on Slashdot.
One of the answers was on the subject of understanding of pointers:
At the opposite end of the spectrum, I actually wish more people understood the really core low-level kind of coding. Not big, complex stuff like the lockless name lookup, but simply good use of pointers-to-pointers etc. For example, I&rsquo;ve seen too many people who delete a singly-linked list entry by keeping track of the &ldquo;prev&rdquo; entry, and then to delete the entry, doing something like
" />






<meta name="generator" content="Hugo 0.146.0 with theme even" />


<link rel="canonical" href="https://grisha.org/blog/2013/04/02/linus-on-understanding-pointers/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">

<link rel="stylesheet" href="/css/custom.css">


<meta property="og:url" content="https://grisha.org/blog/2013/04/02/linus-on-understanding-pointers/">
  <meta property="og:site_name" content="Gregory Trubetskoy">
  <meta property="og:title" content="Linus on understanding pointers">
  <meta property="og:description" content="A while back Linus Torvalds answered questions on Slashdot.
One of the answers was on the subject of understanding of pointers:
At the opposite end of the spectrum, I actually wish more people understood the really core low-level kind of coding. Not big, complex stuff like the lockless name lookup, but simply good use of pointers-to-pointers etc. For example, I’ve seen too many people who delete a singly-linked list entry by keeping track of the “prev” entry, and then to delete the entry, doing something like">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2013-04-02T10:52:00+00:00">
    <meta property="article:modified_time" content="2013-04-02T10:52:00+00:00">

  <meta itemprop="name" content="Linus on understanding pointers">
  <meta itemprop="description" content="A while back Linus Torvalds answered questions on Slashdot.
One of the answers was on the subject of understanding of pointers:
At the opposite end of the spectrum, I actually wish more people understood the really core low-level kind of coding. Not big, complex stuff like the lockless name lookup, but simply good use of pointers-to-pointers etc. For example, I’ve seen too many people who delete a singly-linked list entry by keeping track of the “prev” entry, and then to delete the entry, doing something like">
  <meta itemprop="datePublished" content="2013-04-02T10:52:00+00:00">
  <meta itemprop="dateModified" content="2013-04-02T10:52:00+00:00">
  <meta itemprop="wordCount" content="568">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Linus on understanding pointers">
  <meta name="twitter:description" content="A while back Linus Torvalds answered questions on Slashdot.
One of the answers was on the subject of understanding of pointers:
At the opposite end of the spectrum, I actually wish more people understood the really core low-level kind of coding. Not big, complex stuff like the lockless name lookup, but simply good use of pointers-to-pointers etc. For example, I’ve seen too many people who delete a singly-linked list entry by keeping track of the “prev” entry, and then to delete the entry, doing something like">

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Gregory Trubetskoy</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/posts/">
        <li class="mobile-menu-item">Archives</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Gregory Trubetskoy</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/posts/">Archives</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Linus on understanding pointers</h1>

      <div class="post-meta">
        <span class="post-time"> 2013-04-02 </span>
        
        
      </div>
    </header>

    
    <div class="post-content">
      <p>A while back <a href="http://en.wikipedia.org/wiki/Linus_Torvalds">Linus Torvalds</a> <a href="http://meta.slashdot.org/story/12/10/11/0030249/linus-torvalds-answers-your-questions">answered questions on Slashdot</a>.</p>
<p>One of the answers was on the subject of understanding of pointers:</p>
<blockquote>
<p><small>At the opposite end of the spectrum, I actually wish more people
understood the really core low-level kind of coding. Not big, complex
stuff like the lockless name lookup, but simply good use of
pointers-to-pointers etc. For example, I&rsquo;ve seen too many people who
delete a singly-linked list entry by keeping track of the &ldquo;prev&rdquo;
entry, and then to delete the entry, doing something like</small></p></blockquote>
<blockquote>
<p><small>if (prev)<br/>
prev-&gt;next = entry-&gt;next;<br/>
else<br/>
list_head = entry-&gt;next;<br/>
</small></p></blockquote>
<blockquote>
<p><small>and whenever I see code like that, I just go &ldquo;This person doesn&rsquo;t
understand pointers&rdquo;. And it&rsquo;s sadly quite common.</small></p></blockquote>
<blockquote>
<p><small>People who understand pointers just use a &ldquo;pointer to the entry
pointer&rdquo;, and initialize that with the address of the list_head. And
then as they traverse the list, they can remove the entry without
using any conditionals, by just doing a &ldquo;*pp = entry-&gt;next&rdquo;</small></p></blockquote>
<p>There were a few comments, but none explained what he really
meant. So here it is.</p>
<p>Imagine you have a linked list defined as:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> list_entry {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> val;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">struct</span> list_entry <span style="color:#f92672">*</span>next;
</span></span><span style="display:flex;"><span>} list_entry;
</span></span></code></pre></div><p>You need to iterate over it from the begining to end and remove a
specific element whose value equals the value of <code>to_remove</code>. The more
obvious way to do this would be:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>    list_entry <span style="color:#f92672">*</span>entry <span style="color:#f92672">=</span> head; <span style="color:#75715e">/* assuming head exists and is the first entry of the list */</span>
</span></span><span style="display:flex;"><span>    list_entry <span style="color:#f92672">*</span>prev <span style="color:#f92672">=</span> NULL;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> (entry) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (entry<span style="color:#f92672">-&gt;</span>val <span style="color:#f92672">==</span> to_remove)     <span style="color:#75715e">/* this is the one to remove */</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (prev)
</span></span><span style="display:flex;"><span>               prev<span style="color:#f92672">-&gt;</span>next <span style="color:#f92672">=</span> entry<span style="color:#f92672">-&gt;</span>next; <span style="color:#75715e">/* remove the entry */</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>                head <span style="color:#f92672">=</span> entry<span style="color:#f92672">-&gt;</span>next;      <span style="color:#75715e">/* special case - first entry */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/* move on to the next entry */</span>
</span></span><span style="display:flex;"><span>        prev <span style="color:#f92672">=</span> entry;
</span></span><span style="display:flex;"><span>        entry <span style="color:#f92672">=</span> entry<span style="color:#f92672">-&gt;</span>next;
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p>What we are doing above is iterating over the list until <code>entry</code> is
NULL, which means we&rsquo;ve reached the end of the list (line 4). When we
come across an entry we want removed (line 5), we assign the value of
current <code>next</code> pointer to the previous one, thus eliminating the
current element (line 7).</p>
<p>There is a special case above - at the beginning of the iteration
there is no previous entry (<code>prev</code> is NULL), and so to remove the
first entry in the list you have to modify <code>head</code> itself (line 9).</p>
<p>What Linus was saying is that the above code could be simplified by
making the previous element a <em>pointer to a pointer</em> rather than just a
pointer. The code then looks like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>    list_entry <span style="color:#f92672">**</span>pp <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>head; <span style="color:#75715e">/* pointer to a pointer */</span>
</span></span><span style="display:flex;"><span>    list_entry <span style="color:#f92672">*</span>entry <span style="color:#f92672">=</span> head;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> (entry) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (entry<span style="color:#f92672">-&gt;</span>val <span style="color:#f92672">==</span> to_remove)
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">*</span>pp <span style="color:#f92672">=</span> entry<span style="color:#f92672">-&gt;</span>next;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        pp <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>entry<span style="color:#f92672">-&gt;</span>next;
</span></span><span style="display:flex;"><span>        entry <span style="color:#f92672">=</span> entry<span style="color:#f92672">-&gt;</span>next;
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p>The above code is very similar to the previous variant, but notice how
we no longer need to watch for the special case of the first element
of the list, since <code>pp</code> is not NULL at the beginning. Simple and
clever.</p>
<p>Also, someone in that thread commented that the reason this is better
is because <code>*pp = entry-&gt;next</code> is <em>atomic</em>.  It is most certainly NOT
atomic. The above expression contains two dereference operators (<code>*</code>
and <code>-&gt;</code>) and one assignment, and neither of those three things is
atomic. This is a common misconception, but alas pretty much <em>nothing</em>
in C should ever be assumed to be atomic (including the <code>++</code> and <code>--</code>
operators)!</p>

    </div>

    
<footer class="post-footer">
      
      <nav class="post-nav">
        <a class="prev" href="/blog/2013/04/19/mapjoin-a-simple-way-to-speed-up-your-hive-queries/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">MapJoin: a simple way to speed up your Hive queries</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/blog/2013/04/01/storm-notes/">
            <span class="next-text nav-default">Storm Notes</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        <div id="disqus_thread"></div>
    <script type="text/javascript">
    (function() {
      
      
      if (window.location.hostname === 'localhost') return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'grisha';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2013 - 
    2026<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
